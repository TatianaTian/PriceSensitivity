{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/esm/slicedToArray\"));\n\nvar _storeJs = _interopRequireDefault(require(\"store-js\"));\n\nvar _polaris = require(\"@shopify/polaris\");\n\nvar _bodyParser = require(\"body-parser\");\n\nfunction _createForOfIteratorHelper(o) { if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(n); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar getPearsonCorrelation = require('./calc_correlation');\n\nvar linear_regression = require('./linear_regression');\n\nvar fetch_from_map = function fetch_from_map(select, tabs, maps, product_id_title_map, dropdown_select, product_id_price_map, fx_map) {\n  try {\n    if (select !== 0) {\n      // fetch data for graphs\n      var selected_currency = tabs[select]['id'];\n      console.log(\"selected currency is \", selected_currency);\n      console.log(\"dropdown_select is \", dropdown_select);\n      var selected_data_all_products = maps.get(selected_currency);\n      var selected_data = selected_data_all_products.get(dropdown_select);\n      var product_price = product_id_price_map.get(dropdown_select);\n      var today_fx = fx_map.get(selected_currency);\n      console.log(\"product_price is \", product_price);\n      var product_price_list = selected_data[2].map(function (element) {\n        return element * product_price;\n      });\n\n      var _linear_regression = linear_regression(selected_data[1], product_price_list),\n          _linear_regression2 = (0, _slicedToArray2[\"default\"])(_linear_regression, 4),\n          regression_fx = _linear_regression2[0],\n          regression_sales = _linear_regression2[1],\n          regression_predicted_sales = _linear_regression2[2],\n          slope = _linear_regression2[3];\n\n      console.log(\"regression_fx is \", regression_fx);\n      console.log(\"regression_sales is \", regression_sales);\n      console.log(\"regression_predicted_sales is \", regression_predicted_sales);\n      console.log(\"slope is \", slope);\n      console.log(\"today_product_price is \", today_fx * product_price);\n      console.log(\"selected data is \", selected_data);\n      localStorage.setItem('date', selected_data[0]);\n      localStorage.setItem('price', selected_data[1]);\n      localStorage.setItem('exchange_rate', product_price_list);\n      localStorage.setItem('current_level', selected_data[3]);\n      localStorage.setItem('correlation', getPearsonCorrelation(selected_data[1], selected_data[2])); //localStorage.setItem('regression_fx', regression_fx);\n\n      localStorage.setItem('regression_fx', regression_fx);\n      localStorage.setItem('regression_sales', regression_sales);\n      localStorage.setItem('regression_predicted_sales', regression_predicted_sales);\n      localStorage.setItem('slope', slope);\n      localStorage.setItem('today_product_price', Math.round(today_fx * product_price * 100) / 100);\n      console.log(\"done storing\");\n      /*\n      console.log(\"localStorage.getItem('date') is\",localStorage.getItem('date'))\n      console.log(\"localStorage.getItem('price') is\",localStorage.getItem('price'))\n      console.log(\"localStorage.getItem('exchange_rate') is\",localStorage.getItem('exchange_rate'))*/\n      // find the product price\n      // filter options\n\n      console.log(\"selected_data_all_products is\", selected_data_all_products);\n      console.log('product_id_title_map is ', product_id_title_map);\n      var num_dates = 0;\n      var options = [];\n      var product_options = [];\n\n      var _iterator = _createForOfIteratorHelper(selected_data_all_products),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _step$value = (0, _slicedToArray2[\"default\"])(_step.value, 2),\n              key = _step$value[0],\n              value = _step$value[1];\n\n          num_dates = value[0].length;\n\n          if (num_dates > 1) {\n            var price_set = new Set(value[1]);\n            var fx_set = new Set(value[2]);\n\n            if (price_set.size > 1 && fx_set.size > 1) {\n              console.log('use key to get name ', product_id_title_map.get(key));\n              options.push({\n                label: product_id_title_map.get(key),\n                value: key\n              });\n              product_options.push(key);\n            }\n          }\n\n          console.log(key + ' = ' + value);\n        } // Find the most sensitive product\n\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      var slope_map = new Map();\n      var slope_list = [];\n\n      var _loop = function _loop() {\n        var product_price_rank = product_id_price_map.get(product_options[k]);\n        product_price_list_rank = selected_data_all_products.get(product_options[k])[2].map(function (element) {\n          return element * product_price_rank;\n        });\n\n        var _linear_regression3 = linear_regression(selected_data_all_products.get(product_options[k])[1], product_price_list_rank),\n            _linear_regression4 = (0, _slicedToArray2[\"default\"])(_linear_regression3, 4),\n            regression_fx = _linear_regression4[0],\n            regression_sales = _linear_regression4[1],\n            regression_predicted_sales = _linear_regression4[2],\n            slope = _linear_regression4[3];\n\n        slope_map.set(product_options[k], slope);\n        slope_list.push(slope);\n      };\n\n      for (k = 0; k < product_options.length; k++) {\n        var product_price_list_rank;\n\n        _loop();\n      }\n    }\n  } catch (err) {\n    console.log(\"no id\");\n  }\n\n  return options;\n};\n\nmodule.exports = fetch_from_map;","map":{"version":3,"sources":["/Users/tatianatian/Desktop/Startup/shopify_front_back_end/client/functions/fetch_from_map.js"],"names":["getPearsonCorrelation","require","linear_regression","fetch_from_map","select","tabs","maps","product_id_title_map","dropdown_select","product_id_price_map","fx_map","selected_currency","console","log","selected_data_all_products","get","selected_data","product_price","today_fx","product_price_list","map","element","regression_fx","regression_sales","regression_predicted_sales","slope","localStorage","setItem","Math","round","num_dates","options","product_options","key","value","length","price_set","Set","fx_set","size","push","label","slope_map","Map","slope_list","product_price_rank","k","product_price_list_rank","set","err","module","exports"],"mappings":"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","sourcesContent":["import store from 'store-js';\nimport { KeypressListener } from '@shopify/polaris';\nimport { json } from 'body-parser';\n\nconst getPearsonCorrelation = require('./calc_correlation')\nconst linear_regression = require('./linear_regression')\n\nconst fetch_from_map = (select, tabs, maps, product_id_title_map, dropdown_select, product_id_price_map, fx_map) => {\n\n\n    try{\n        \n        if (select !== 0){\n            // fetch data for graphs\n            const selected_currency = tabs[select]['id']\n            console.log(\"selected currency is \", selected_currency)\n            console.log(\"dropdown_select is \", dropdown_select)\n\n\n            const selected_data_all_products = maps.get(selected_currency)\n            const selected_data = selected_data_all_products.get(dropdown_select)\n            const product_price = product_id_price_map.get(dropdown_select)\n            const today_fx = fx_map.get(selected_currency)\n            console.log(\"product_price is \", product_price)\n\n            var product_price_list = selected_data[2].map(function(element) {\n                return element*product_price;\n            });\n\n            const [regression_fx, regression_sales, regression_predicted_sales, slope] = linear_regression(selected_data[1],product_price_list)\n\n   \n                \n            console.log(\"regression_fx is \", regression_fx);\n            console.log(\"regression_sales is \", regression_sales);\n            console.log(\"regression_predicted_sales is \", regression_predicted_sales);\n            console.log(\"slope is \", slope);\n            console.log(\"today_product_price is \", today_fx*product_price);\n            console.log(\"selected data is \", selected_data)\n\n            localStorage.setItem('date', selected_data[0]);\n            localStorage.setItem('price', selected_data[1]);\n            localStorage.setItem('exchange_rate', product_price_list);\n            localStorage.setItem('current_level', selected_data[3]);\n            localStorage.setItem('correlation', getPearsonCorrelation(selected_data[1],selected_data[2]));\n            //localStorage.setItem('regression_fx', regression_fx);\n            localStorage.setItem('regression_fx', regression_fx);\n            localStorage.setItem('regression_sales', regression_sales);\n            localStorage.setItem('regression_predicted_sales', regression_predicted_sales);\n            localStorage.setItem('slope', slope);\n            localStorage.setItem('today_product_price', Math.round(today_fx*product_price*100)/100);\n\n            console.log(\"done storing\")\n            /*\n            console.log(\"localStorage.getItem('date') is\",localStorage.getItem('date'))\n            console.log(\"localStorage.getItem('price') is\",localStorage.getItem('price'))\n            console.log(\"localStorage.getItem('exchange_rate') is\",localStorage.getItem('exchange_rate'))*/\n\n            // find the product price\n\n\n\n\n\n\n\n            // filter options\n            console.log(\"selected_data_all_products is\",selected_data_all_products)\n            console.log('product_id_title_map is ', product_id_title_map)\n            var num_dates = 0\n            var options = []\n            var product_options = []\n            for (let [key, value] of selected_data_all_products) {\n                num_dates = value[0].length\n                if (num_dates>1){\n                    var price_set = new Set(value[1]);\n                    var fx_set = new Set(value[2]);\n                    if (price_set.size>1 && fx_set.size>1){\n                        console.log('use key to get name ', product_id_title_map.get(key))\n                        options.push(\n                            {\n                                label:product_id_title_map.get(key), value: key\n                            }\n                        )\n                        product_options.push(key)\n                    }\n\n                 \n                }\n\n                console.log(key + ' = ' + value)\n            }\n\n            // Find the most sensitive product\n            let slope_map = new Map()\n            var slope_list = []\n            for (k=0; k<product_options.length; k++){\n                const product_price_rank = product_id_price_map.get(product_options[k])\n                var product_price_list_rank = selected_data_all_products.get(product_options[k])[2].map(function(element) {\n                    return element*product_price_rank;\n                });\n                const [regression_fx, regression_sales, regression_predicted_sales, slope] = linear_regression(selected_data_all_products.get(product_options[k])[1],product_price_list_rank)\n                slope_map.set(product_options[k], slope)\n                slope_list.push(slope)\n\n            }\n            \n\n\n        }\n\n        \n\n\n\n    } catch(err){\n        console.log(\"no id\")\n    }\n    \n    return options\n}\n\nmodule.exports = fetch_from_map; \n\n"]},"metadata":{},"sourceType":"script"}